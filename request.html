<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request Movie | Dashflix</title>
    <meta name="description" content="Watch free movies and TV series online with multiple genres at Dashflix.">
    <meta name="keywords" content="Free movies, Watch free TV series, Online streaming">
    <meta property="og:title" content="Dashflix" />
    <meta property="og:description" content="Free, Watch free movies, Online streaming" />
    <meta property="og:url" content="https://dashflix.top/request" />
    <meta property="og:image" content="https://i.postimg.cc/YCWDLrdF/th.webp" />
    <link rel="icon" href="https://i.postimg.cc/g2n9TLBn/favicon.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="styler.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    </head>
    <body>
      <div class="shoutbox-container">
      <h1 class="shoutbox-title">Request Box</h1>
      <p>Please refrain from requesting movies that haven't been released yet.</p></br>
      <p>And before you request, please try searching it on movies section first if it's a movie and on the shows section if it's a tv show.</p>
      <div class="messages" id="messages"></div>
      <div class="message-input">
          <input type="text" id="usernameInput" placeholder="Title" required>
          <input type="text" id="messageInput" placeholder="Genre and Year" required>
          <button onclick="addMessage()"><i class="fas fa-paper-plane"></i> Request</button>
      </div>
  </div>

  <script>
      let lastMessageId = null; // Track the latest message ID

      // Function to load messages and update the message container
async function loadMessages() {
    try {
        const response = await fetch("https://kabayan.top/shoutbox.php");
        const messages = await response.json();
        const messagesDiv = document.getElementById("messages");

        // Check if user is at the bottom before loading new messages
        const atBottom = isAtBottom(messagesDiv);

        // Loop through messages and append only new ones
        messages.forEach(msg => {
            if (!document.getElementById(`message-${msg.id}`)) {
                const messageElement = document.createElement("div");
                messageElement.classList.add("message");
                messageElement.id = `message-${msg.id}`;
                messageElement.innerHTML = `<strong>${msg.username}</strong>: ${msg.message} <br><small>${msg.timestamp}</small>`;
                messagesDiv.appendChild(messageElement);
            }
        });

        // Scroll to bottom only if user was already at the bottom
        if (atBottom) {
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
    } catch (error) {
        console.error("Error loading messages:", error);
    }
}

      function isAtBottom(element) {
          return element.scrollHeight - element.scrollTop <= element.clientHeight + 1;
      }

      // Function to send a new message to the server
      async function addMessage() {
          const usernameInput = document.getElementById("usernameInput");
          const messageInput = document.getElementById("messageInput");
          const username = usernameInput.value.trim();
          const message = messageInput.value.trim();

          if (username && message) {
              try {
                  await fetch("https://kabayan.top/shoutbox.php", {
                      method: "POST",
                      headers: { "Content-Type": "application/x-www-form-urlencoded" },
                      body: `username=${encodeURIComponent(username)}&message=${encodeURIComponent(message)}`
                  });
                  messageInput.value = "";
                  loadMessages(); // Load messages after posting a new one
              } catch (error) {
                  console.error("Error sending message:", error);
              }
          }
      }

      // Initial load and periodic refresh every 5 seconds
      loadMessages(); // Load initially
      setInterval(loadMessages, 5000); // Refresh every 5 seconds
  </script>

          <nav class="bottom-nav">
            <a href="index.html" class="nav-item">
              <i class="fas fa-home"></i> Home
            </a>
            <a href="movies.html" class="nav-item">
              <i class="fas fa-film"></i> Movies
            </a>
            <a href="shows.html" class="nav-item">
              <i class="fas fa-tv"></i> Shows
            </a>
            <a href="trailer.html" class="nav-item">
              <i class="fas fa-video"></i> Trailers
            </a>
            <a href="requested.html" class="nav-item">
              <i class="fas fa-list"></i> Requested
            </a>
            <a href="#" class="nav-item" id="more-menu">
              <i class="fas fa-ellipsis-h"></i> More
            </a>

            <div id="more-links" class="more-links">
              <a href="https://freedomwall.top">
                <i class="fas fa-otter"></i> Anime
              </a>
              <a href="https://dashtoons.xyz">
                <i class="fas fa-book-open"></i> Comics
              </a>
              <a href="https://kabayan.top">
                <i class="fas fa-theater-masks"></i> Drama
              </a>
              <a href="tvplus.html">
                <i class="fas fa-broadcast-tower"></i> Live TV
              </a>
              <a href="#" class="nav-item" onclick="showPasswordModal(event)">
          ðŸ”’ 18+
              </a>
              <a href="appdown.html">
                <i class="fas fa-mobile-alt"></i> APP
              </a>
            </div>
          </nav>

          <script>
            document.addEventListener('DOMContentLoaded', function() {
              const moreMenu = document.getElementById('more-menu');
              const moreLinks = document.getElementById('more-links');

              moreMenu.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent the default anchor action
                moreLinks.classList.toggle('show'); // Toggle visibility by adding/removing the 'show' class
              });
            });
          </script>

          <div class="modal" id="passwordModal">
              <div class="modal-content">
                  <h2>Warning: This page contains adult content.</h2>
                  <p>Please enter GOBILAM to proceed:</p>
                  <input type="text" id="passwordInput" placeholder="Enter GOBILAM">
                  <button onclick="checkPassword()">Submit</button>
                  <button onclick="closeModal()">Cancel</button>
              </div>
          </div>

          <script>
              function showPasswordModal(event) {
                  event.preventDefault(); // Prevent the default link behavior
                  document.getElementById('passwordModal').style.display = 'block'; // Show the modal
              }

              function closeModal() {
                  document.getElementById('passwordModal').style.display = 'none'; // Hide the modal
              }

              function checkPassword() {
                  const password = document.getElementById('passwordInput').value;
                  if (password === "GOBILAM") {
                      window.location.href = "adult.html"; // Redirect to the adult content page
                  } else {
                      alert("Incorrect password. Access denied."); // Alert for incorrect password
                  }
              }
          </script>
          <script src="script.js"></script>
</body>
</html>
