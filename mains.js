const API_KEY="4f599baa15d072c9de346b2816a131b8",BASE_URL="https://api.themoviedb.org/3",IMAGE_BASE_URL="https://image.tmdb.org/t/p/w500";let shows=[],currentPage=1,searchQuery="",isLoading=!1,blockedShowIdsSet=new Set([81329,94722,112470]);async function fetchShows(page=1){try{isLoading=!0,document.getElementById("loading-spinner").style.display="block";const response=await fetch(`${BASE_URL}/tv/popular?api_key=${API_KEY}&language=en-US&page=${page}`),data=await response.json();const availableShows=data.results.filter(show=>!blockedShowIdsSet.has(show.id));displayShows(availableShows),isLoading=!1,document.getElementById("loading-spinner").style.display="none"}catch(e){console.error("Error fetching shows:",e),isLoading=!1}}function displayShows(showsList){const gallery=document.getElementById("gallery");if(currentPage===1)gallery.innerHTML="";showsList.forEach(show=>{const column=document.createElement("div");column.className="column";const spinner=document.createElement("div");spinner.className="spinner";const image=document.createElement("img");image.className="lazy-image";const posterPath=show.poster_path?IMAGE_BASE_URL+show.poster_path:"https://i.postimg.cc/d3YGThwG/AD.png";image.setAttribute("data-src",posterPath),image.alt=show.name,image.addEventListener("load",()=>{image.classList.add("loaded"),spinner.style.display="none"}),image.addEventListener("error",()=>{spinner.style.display="none",console.error(`Failed to load image for show: ${show.name}`)});const link=document.createElement("a");link.href=`players.html?id=${show.id}`,link.target="_self",link.appendChild(image),column.appendChild(spinner),column.appendChild(link),gallery.appendChild(column)}),initializeLazyLoad()}function initializeLazyLoad(){const lazyImages=document.querySelectorAll("img.lazy-image"),imageObserver=new IntersectionObserver(entries=>{entries.forEach(entry=>{if(entry.isIntersecting){const lazyImage=entry.target;lazyImage.src=lazyImage.dataset.src,lazyImage.onload=()=>{lazyImage.classList.add("loaded")},imageObserver.unobserve(lazyImage)}})});lazyImages.forEach(image=>imageObserver.observe(image))}window.addEventListener("scroll",()=>{window.innerHeight+window.scrollY>=document.body.offsetHeight-100&&!isLoading&&(currentPage++,fetchShows(currentPage))}),fetchShows();function handleSearch(){const query=document.getElementById("search-bar").value.trim();searchQuery=query,currentPage=1,shows=[],query?searchShows(query):fetchShows()}async function searchShows(query,page=1){try{isLoading=!0,document.getElementById("loading-spinner").style.display="block";const response=await fetch(`${BASE_URL}/search/tv?api_key=${API_KEY}&language=en-US&query=${query}&page=${page}`),data=await response.json();const availableShows=data.results.filter(show=>!blockedShowIdsSet.has(show.id));displayShows(availableShows),isLoading=!1,document.getElementById("loading-spinner").style.display="none"}catch(e){console.error("Error searching shows:",e),isLoading=!1}}document.getElementById("search-bar").addEventListener("input",handleSearch);
