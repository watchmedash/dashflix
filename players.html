<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV Show Player</title>
    <link rel="stylesheet" href="load.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<script type='text/javascript' src='//perilastronaut.com/73/9e/4b/739e4b210c84c2fb3f69faa2c57e9547.js'></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #fff;
            margin: 0;
            padding: 0;
        }
        .tv-show-container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #333;
            border-radius: 10px;
            background-color: #1e1e1e;
        }
        .tv-show-container h1 {
            text-align: center;
            color: #fff;
            margin: 10px 0;
        }
        .tv-show-details {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        .tv-show-details img {
            max-width: 200px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
        }
        .tv-show-info {
            flex: 1;
            margin-left: 20px;
        }
        .tv-show-info h2 {
            margin: 0;
            font-size: 1.5rem;
            color: #fff;
        }
        .tv-show-info p {
            font-size: 1rem;
            margin: 5px 0;
            color: #bbb;
        }
        .tv-show-info .rating {
            font-size: 1.2rem;
            color: #ffd700;
        }
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            width: 100%;
            margin: 0 auto;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        select {
            width: 100%;
            padding: 10px;
            margin: 20px 0;
            background-color: #333;
            color: #fff;
            border: 1px solid #444;
            border-radius: 5px;
        }
        .close-btn {
            background-color: #ff3333;
            color: #fff;
            font-size: 1.5rem;
            border: none;
            padding: 10px;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 20px;
            text-align: center;
            display: block;
            width: 100%;
        }
        .close-btn:hover {
            background-color: #cc0000;
        }
    </style>
</head>
<body>
  <div id="loaning-screen">
    <img src="images/logo.webp" alt="Loading..." />
    <div class="progress-bar">
        <div class="progress"></div>
    </div>
  </div>
  <script async="async" data-cfasync="false" src="//perilastronaut.com/d484cbb1a159c0b78e6b95df88af59b9/invoke.js"></script>
  <div id="container-d484cbb1a159c0b78e6b95df88af59b9"></div>
<div class="tv-show-container">
    <select id="season-dropdown" onchange="fetchEpisodes()">
        <option value="">Select Season</option>
    </select>
    <select id="episode-dropdown" onchange="changeEpisode()" style="display: none;"></select>

    <div class="video-container">
        <iframe id="video-player" src="" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>
    </div>

    <div class="tv-show-details">
        <img id="tv-poster" src="" alt="TV Show Poster">
        <div class="tv-show-info">
            <h2 id="tv-title-info">Loading...</h2>
            <p><strong>First Air Year:</strong> <span id="release-year">Loading...</span></p>
            <p><strong>Genres:</strong> <span id="genres">Loading...</span></p>
            <p><strong>Rating:</strong> <span id="rating" class="rating">Loading...</span></p>
            <p><strong>Overview:</strong></p>
            <p id="tv-overview">Loading...</p>
            <p><strong>Creator:</strong> <span id="creator">Loading...</span></p>
        </div>
    </div>
    <button class="close-btn" onclick="goBack()">Go Back</button>
</div>

<script>
    const API_KEY = "4f599baa15d072c9de346b2816a131b8";
    const BASE_URL = "https://api.themoviedb.org/3";
    const IMAGE_BASE_URL = "https://image.tmdb.org/t/p/w500";

    const urlParams = new URLSearchParams(window.location.search);
    const tvShowId = urlParams.get("id");

    async function fetchTvShowDetails() {
        try {
            const response = await fetch(`${BASE_URL}/tv/${tvShowId}?api_key=${API_KEY}&language=en-US`);
            const tvShow = await response.json();
            displayTvShowDetails(tvShow);
            populateSeasonDropdown(tvShow.seasons);
        } catch (error) {
            console.error("Error fetching TV show details:", error);
        }
    }

    function displayTvShowDetails(tvShow) {
        document.getElementById("tv-title-info").textContent = tvShow.name;
        document.getElementById("tv-poster").src = IMAGE_BASE_URL + tvShow.poster_path;
        document.getElementById("tv-overview").textContent = tvShow.overview;
        document.getElementById("release-year").textContent = tvShow.first_air_date.split("-")[0];
        document.getElementById("rating").textContent = tvShow.vote_average;
        document.getElementById("genres").textContent = tvShow.genres.map(genre => genre.name).join(", ");
        document.getElementById("creator").textContent = tvShow.created_by.map(creator => creator.name).join(", ");
    }

    function populateSeasonDropdown(seasons) {
        const seasonDropdown = document.getElementById("season-dropdown");
        const firstSeason = seasons.find(season => season.air_date); // First released season

        seasons
            .filter(season => season.air_date)
            .forEach(season => {
                const option = document.createElement("option");
                option.value = season.season_number;
                option.textContent = `Season ${season.season_number}`;
                seasonDropdown.appendChild(option);
            });

        // Default to first season
        if (firstSeason) {
            seasonDropdown.value = firstSeason.season_number;
            fetchEpisodes();
        }
    }

    async function fetchEpisodes() {
        const season = document.getElementById("season-dropdown").value;
        if (!season) return;

        const response = await fetch(`${BASE_URL}/tv/${tvShowId}/season/${season}?api_key=${API_KEY}&language=en-US`);
        const seasonDetails = await response.json();
        populateEpisodeDropdown(seasonDetails.episodes);
    }

    function populateEpisodeDropdown(episodes) {
        const episodeDropdown = document.getElementById("episode-dropdown");
        episodeDropdown.style.display = "block";
        episodeDropdown.innerHTML = `<option value="">Select Episode</option>`;
        const firstEpisode = episodes.find(episode => episode.air_date); // First released episode

        episodes
            .filter(episode => episode.air_date)
            .forEach(episode => {
                const option = document.createElement("option");
                option.value = episode.episode_number;
                option.textContent = `Episode ${episode.episode_number}: ${episode.name}`;
                episodeDropdown.appendChild(option);
            });

        // Default to the first episode
        if (firstEpisode) {
            episodeDropdown.value = firstEpisode.episode_number;
            changeEpisode();
        }
    }

    function changeEpisode() {
        const season = document.getElementById("season-dropdown").value;
        const episode = document.getElementById("episode-dropdown").value;

        if (season && episode) {
            const videoPlayer = document.getElementById("video-player");
            videoPlayer.src = `https://vidsrc.xyz/embed/tv?tmdb=${tvShowId}&season=${season}&episode=${episode}`;
        }
    }

    function goBack() {
        window.location.href = "shows.html"; // Navigate to shows.html
    }

    fetchTvShowDetails();
</script>
<script src="load.js"></script>
</body>
</html>
